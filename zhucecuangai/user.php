<?php
session_start();
require_once('config.php');

if (!isset($_SESSION['user_id'])) {
  header('Location: login.php');
  exit();
}

$user_id = $_SESSION['user_id'];

$user_query = "SELECT * FROM users WHERE id = '$user_id'";
$user_result = mysqli_query($conn, $user_query);
$user = mysqli_fetch_assoc($user_result);

$role = $user['userid'] == 1 ? 'admin' : 'user';

if ($role === 'admin') {
  $all_users_query = "SELECT * FROM users";
  $all_users_result = mysqli_query($conn, $all_users_query);
}

?>

<!DOCTYPE html>
<html>
<head>
  <title>User Information</title>
</head>
<body>
  <h1>User Information</h1>
  <p>ID: <?php echo $user['id']; ?></p>
  <p>USER ID: <?php echo $user['userid']; ?></p>
  <p>Username: <?php echo $user['username']; ?></p>
  <p>Email: <?php echo $user['email']; ?></p>
  <p>Address: <?php echo $user['address']; ?></p>
  <p>Phone: <?php echo $user['phone']; ?></p>
  <p>Hobby: <?php echo $user['hobby']; ?></p>
  <p>Gender: <?php echo $user['gender']; ?></p>
  <p>Alias: <?php echo $user['alias']; ?></p>
  <p>Role: <?php echo $role; ?></p>

  <?php if ($role == 'admin'): ?>
    <h2>All Users</h2>
    <table border="1">
      <tr>
        <th>ID</th>
        <th>Username</th>
        <th>Email</th>
      </tr>
      <?php while ($row = mysqli_fetch_assoc($all_users_result)): ?>
        <tr>
          <td><?php echo $row['id']; ?></td>
          <td><?php echo $row['username']; ?></td>
          <td><?php echo $row['email']; ?></td>
        </tr>
      <?php endwhile; ?>
    </table>
  <?php endif; ?>

  <p><a href="logout.php">Logout</a></p>
  <p><a href="user_update.php">update message</a></p>
</body>
</html>
