<?php
session_start();
require_once('config.php');

// 获取表单数据
$username = $_POST['username'];
$password = $_POST['password'];
$email = $_POST['email'];
$user_id = isset($_POST['user_id']) ? $_POST['user_id'] : NULL;

// 检查用户名是否已经存在
$check_query = "SELECT * FROM users WHERE username = '$username'";
$check_result = mysqli_query($conn, $check_query);
if (mysqli_num_rows($check_result) > 0) {
  echo "Username already exists.";
} else {
  // 根据是否指定了 user_id 字段，执行不同的 SQL 插入查询
  if ($user_id == 1) {
    $insert_query = "INSERT INTO users (userid, username, password, email) VALUES ('$user_id', '$username', '$password', '$email')";
  } else {
    $insert_query = "INSERT INTO users (username, password, email) VALUES ('$username', '$password', '$email')";
  }

  // 执行 SQL 插入查询
  if (mysqli_query($conn, $insert_query)) {
    echo "User registered successfully."."<br>";
    echo "User ID: " . "0"."<br>";
    echo "Username: " . $username."<br>";
    echo "Password: " . $password."<br>";
    echo "Email: " . $email."<br>";
  } else {
    echo "Error: " . $insert_query . "<br>" . mysqli_error($conn);
  }
}

mysqli_close($conn);
?>

<p><a href="login.php">Login</a></p>
