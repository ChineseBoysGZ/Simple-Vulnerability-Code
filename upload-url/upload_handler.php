<?php
$dataUri = $_POST['dataUri'];
$uploadDir = 'uploads/';

if (preg_match('/^data:(\w+\/\w+);base64,(.*)$/', $dataUri, $matches)) {
  $mimeType = $matches[1];
  $extension = getExtensionFromMimeType($mimeType);
  $base64Data = $matches[2];

  if ($extension) {
    $filename = uniqid() . '.' . $extension;
    $filePath = $uploadDir . $filename;
    $decodedData = base64_decode($base64Data);

    if (file_put_contents($filePath, $decodedData)) {
      echo 'File uploaded successfully: ' . $filename;
    } else {
      echo 'Failed to save file.';
    }
  } else {
    echo 'Unsupported file type.';
  }
} else {
  echo 'Invalid Data URI.';
}

function getExtensionFromMimeType($mimeType) {
  $extensions = [
    'image/jpeg' => 'jpg',
    'image/png' => 'png',
    'image/gif' => 'gif'
  ];

  return isset($extensions[$mimeType]) ? $extensions[$mimeType] : null;
}
?>
