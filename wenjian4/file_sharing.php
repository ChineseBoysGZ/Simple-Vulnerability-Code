<?php
session_start();
require_once('config.php');

if (!isset($_SESSION['user_id'])) {
    header('Location: login.php');
    exit;
}

$sql = "SELECT * FROM files WHERE user_id = {$_SESSION['user_id']}";
$result = mysql_query($sql, $conn);
$files = array();
while ($row = mysql_fetch_assoc($result)) {
    $files[$row['id']] = array('filename' => $row['filename'], 'user_id' => $row['user_id']);
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>File Sharing</title>
</head>
<body>
    <h1>File Sharing</h1>

    <h2>Upload File</h2>
    <form action="upload.php" method="POST" enctype="multipart/form-data">
        <input type="file" name="file">
        <input type="submit" value="Upload">
    </form>

    <h2>Share Files</h2>
    <ul>
        <?php foreach ($files as $file_id => $file): ?>
            <li><?php echo $file['filename']; ?> <button class="share" data-file-id="<?php echo $file_id; ?>">Share</button></li>
        <?php endforeach; ?>
    </ul>

    <a href="logout.php">Logout</a>

    <script>
        document.querySelectorAll('.share').forEach(function (button) {
            button.addEventListener('click', function () {
                var file_id = button.getAttribute('data-file-id');
                window.open('share.php?file_id=' + file_id);
            });
        });
    </script>
</body>
</html>
