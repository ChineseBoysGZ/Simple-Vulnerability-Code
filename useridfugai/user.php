<?php
session_start();
require_once 'config.php';

if (!isset($_SESSION['user_id'])) {
    header('Location: index.php');
    exit;
}

$is_admin = $_SESSION['is_admin'];

if (isset($_POST['update']) && isset($_POST['personal_info'])) {
    $personal_info = mysql_real_escape_string($_POST['personal_info']);
    $user_id = $_SESSION['user_id'];

    $sql = "UPDATE users SET personal_info = '$personal_info' WHERE id = $user_id";
    $result = mysql_query($sql);

    if ($result) {
        echo "Your personal information has been updated!";
    } else {
        echo "Error updating personal information: " . mysql_error();
    }
}

$user_id = $_SESSION['user_id'];
$user_name = $_SESSION['user_name'];
$personal_info = $_SESSION['personal_info'];
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>User Dashboard</title>
</head>
<body>
    <h1>Welcome, <?php echo $user_name; ?>!</h1>
    <p>Your user ID is: <?php echo $user_id; ?></p>
    <p>Your personal information: <?php echo $personal_info; ?></p>

    <form action="user.php" method="post">
        <label for="personal_info">Update personal information:</label>
        <input type="text" id="personal_info" name="personal_info" required>
        <input type="submit" name="update" value="Update">
    </form>

    <?php if ($is_admin): ?>
        <h2>All Users</h2>
        <table>
            <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Name</th>
                <th>Personal Info</th>
            </tr>
            <?php
                $sql = "SELECT * FROM users";
                $result = mysql_query($sql);
                while ($row = mysql_fetch_assoc($result)) {
                    echo "<tr>";
                    echo "<td>" . $row['id'] . "</td>";
                    echo "<td>" . $row['username'] . "</td>";
                    echo "<td>" . $row['name'] . "</td>";
                    echo "<td>" . $row['personal_info'] . "</td>";
                    echo "</tr>";
                }
            ?>
        </table>
    <?php endif; ?>

    <form action="logout.php" method="post">
        <input type="submit" name="logout" value="Logout">
    </form>

</body>
</html>
