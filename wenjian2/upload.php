<?php
session_start();
require_once('config.php');

if (!isset($_SESSION['user_id'])) {
    header('Location: login.php');
    exit;
}

if (isset($_FILES['file'])) {
    $target_dir = "uploads/";
    $target_file = $target_dir . basename($_FILES["file"]["name"]);
    move_uploaded_file($_FILES["file"]["tmp_name"], $target_file);
    $escaped_target_file = mysql_real_escape_string($target_file);
    $sql = "INSERT INTO files (user_id, filename, filepath) VALUES ('{$_SESSION['user_id']}', '{$escaped_target_file}', '{$escaped_target_file}')";
    mysql_query($sql, $conn);
}

header('Location: file_sharing.php');
exit;
